<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <!-- import CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
	<link href="../css/apply.css" rel="stylesheet" media="screen">
    <!-- import Vue before Element -->
    <script src="https://unpkg.com/vue/dist/vue.js"></script>
    <!-- import JavaScript -->
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <!-- import JQuery -->
    <script src="https://cdn.staticfile.org/jquery/3.1.1/jquery.min.js"></script>

</head>
<style>
    .el-header, .el-footer {
        background-color: #FFFFFF;
        color: #333;
        text-align: center;
        line-height: 60px;
    }
    .el-aside {
        background-color: #D3DCE6;
        color: #333;
        text-align: center;
        line-height: 200px;
    }
    .el-container.el-main {
        background-color: #E9EEF3;
        color: #333;
        text-align: center;
        line-height: 160px;
    }
    body > .el-container {
        margin-bottom: 40px;
    }
    .el-container:nth-child(5) .el-aside,
    .el-container:nth-child(6) .el-aside {
        line-height: 260px;
    }
    .el-container:nth-child(7) .el-aside {
        line-height: 320px;
    }
    .text {
        font-size: 18px;
    }
    .item {
        margin-bottom: 18px;
    }
    .clearfix:before,
    .clearfix:after {
        display: table;
        content: "";
    }
    .clearfix:after {
        clear: both
    }
    .matchName {
        font-size: 20px;
        line-height: 1.5;
        font-family:"微软雅黑";
        font-weight: 700;
    }
    .el-button {
        font-size: 15px;
    }
    .el-row {
        margin-top: 40px;
    }
    .box-card {
        width:100%;
    }
</style>

<body>
<div id="main">
    <el-container style="height: 100%; border: 1px solid #eee">
        <el-aside width="200px" style="background-color: rgb(238, 241, 246)" v-if="role=='学生'">
            <el-menu >
                <el-menu
                        default-active="1"
                        class="el-menu-vertical-demo"
                        @select="stuSetSidebarIndex">

                    <el-menu-item index="1">
                        <i class="el-icon-menu"></i>
                        <span slot="title">查看比赛</span>
                    </el-menu-item>
                    <el-menu-item index="2">
                        <i class="el-icon-document"></i>
                        <span slot="title">查看已提交申请</span>
                    </el-menu-item>
                    <el-menu-item index="3">
                        <i class="el-icon-setting"></i>
                        <span slot="title">修改个人信息</span>
                    </el-menu-item>
                </el-menu>
        </el-aside>
        <el-aside width="200px" style="background-color: rgb(238, 241, 246)" v-else-if="role=='团委'">

                <el-menu
                        default-active="1"
                        class="el-menu-vertical-demo"
                        @select="twSetSidebarIndex">

                    <el-menu-item index="1">
                        <i class="el-icon-menu"></i>
                        <span slot="title">比赛管理</span>
                    </el-menu-item>
                    <el-menu-item index="3">
                        <i class="el-icon-setting"></i>
                        <span slot="title">申请管理</span>
                    </el-menu-item>
                    <el-menu-item index="4">
                        <i class="el-icon-user"></i>
                        <span slot="title">专家管理</span>
                    </el-menu-item>
                </el-menu>
        </el-aside>
        <!-- 专家侧边栏 -->
        <el-aside width="200px" style="background-color: rgb(238, 241, 246)" v-else-if="role=='专家'" >
                <el-menu
                        default-active="1"
                        class="el-menu-vertical-demo"
                        @select="expertSetSidebarIndex">

                    <el-menu-item index="1" >
                        <i class="el-icon-menu"></i>
                        <span slot="title">查看比赛</span>
                    </el-menu-item>
                    <el-menu-item index="2" >
                        <i class="el-icon-document"></i>
                        <span slot="title">评审作品</span>
                    </el-menu-item>
                    <el-menu-item index="3" >
                        <i class="el-icon-setting"></i>
                        <span slot="title">修改个人信息</span>
                    </el-menu-item>
                </el-menu>
        </el-aside>

        <!-- header -->
        <el-container>
            <el-header style="text-align: left;margin-bottom: 10px">
                <el-row :gutter="12" style="margin-top: 10px">
                    <el-col :span="12">
                        <strong style="font-size: 24px;text-align: left;"> 北京航空航天大学科技竞赛平台 </strong >
                    </el-col>
                    <el-col :offset="11" :span="1">
                        <el-avatar size="large"> {{ userInfo.username }} </el-avatar>
                    </el-col>
                </el-row>
            </el-header>

                <!--专家评审作品-->
            <el-main v-if="sidebarIndex==2 && role=='专家'">
                <el-table :data="auditData" border empty-text="您没有待评审作品">
                    <el-table-column width="45" type="selection" align="center"></el-table-column>
                    <el-table-column label="序号" width="90"  align="center" prop="id"></el-table-column>
                    <el-table-column label="作品名称" width="400" prop="workName" align="center"></el-table-column>
                    <el-table-column label="第一作者" width="180" prop="name" align="center"></el-table-column>

                    <el-table-column label="预览操作" align="center" width="240" >
                        <template slot-scope="scope">
                            <el-button type="primary" size="mini" @click="previewImg(scope.$index)">图片</el-button>
                            <el-button type="primary" size="mini" @click="previewDoc(scope.$index)">文件</el-button>
                            <el-button type="primary" size="mini" @click="previewVid(scope.$index)">视频</el-button>
                        </template>
                    </el-table-column>
                    <el-table-column label="下载" align="center" width="108">
                        <template slot-scope="scope">
                            <el-button type="primary" size="mini">下载<i class="el-icon-download"></i></el-button>
                        </template>
                    </el-table-column>
                    <el-table-column label="得分" width="150" prop="score" align="center">
                        <template slot-scope="scope">
                            <el-input placeholder="请在此处评分"  v-model.number="scope.row.score" suffix-icon="el-icon-edit"  ></el-input>
                        </template>
                    </el-table-column>
                    <el-table-column label="评语" width="210" prop="comment" align="center">
                        <template slot-scope="scope">
                            <el-button type="primary" size="mini" icon="el-icon-edit" @click="editComment=true" >编辑评语</el-button>
                            <el-button type="text" size="mini" icon="el-icon-search">查看评语</el-button>
                        </template>
                    </el-table-column>
                </el-table>


                <el-dialog title="评语填写" :auditVisible.sync="editComment" :close-on-click-modal="false">
                    <el-form :model="editAuditForm" label-position="top" label-width="80px" ref="editAuditForm">
                        <el-form-item label="填写评论" prop="comment">
                            <el-input type="textarea" v-model="editAuditForm.comment"></el-input>
                        </el-form-item>
                        <el-button type="primary">提交</el-button>
                    </el-form>
                </el-dialog>

                <el-dialog title="评语查看" :auditVisible.sync="viewComment" :close-on-click-modal="false">

                </el-dialog>

            </el-main>

            <!-- 专家修改个人信息 -->
            <el-main v-if="sidebarIndex==3 && role=='专家'">
                    <el-row :gutter="12" style="margin-top: 10px">
                        <el-col :offset="6" :span="12">
                    <el-form label-width="100px" >
                        <el-form-item label="用户名">
                            <el-input v-model="userInfo.username"></el-input>
                        </el-form-item>
                        <el-form-item label="真实姓名">
                            <el-input v-model="userInfo.name"></el-input>
                        </el-form-item>
                        <el-form-item label="个人信息">
                            <el-input type="textarea" v-model="userInfo.introduction"></el-input>
                        </el-form-item>
                        <el-form-item label="电话">
                            <el-input type="number" v-model="userInfo.phone"></el-input>
                        </el-form-item>
                        <el-form-item label="关注作品类别">
                            <el-select v-model="userInfo.category">
                                <el-option value="A" label="A.机械与控制（包括机械、仪器仪表、自动化控制、工程、交通、建筑等）"></el-option>
                                <el-option value="B" label="B.信息技术（包括计算机、电信、通讯、电子等）"></el-option>
                                <el-option value="C" label="C.数理（包括数学、物理、地球与空间科学等）"></el-option>
                                <el-option value="D" label="D.生命科学(包括生物､农学､药学､医学､健康､卫生､食品等)"></el-option>
                                <el-option value="E" label="E.能源化工（包括能源、材料、石油、化学、化工、生态、环保等）"></el-option>
                                <el-option value="F" label="F.哲学社会科学（包括哲学、经济、社会、法律、教育、管理）"></el-option>
                            </el-select>
                        </el-form-item>
                        <el-form-item>
                            <el-button type="primary" @click="modifyInfo">确认修改</el-button>
                            <el-button @click="resetForm">重置</el-button>
                        </el-form-item>
                    </el-form>
                    </el-col>
                    </el-row>
                </el-main>
            <!-- 学生或专家查看比赛（并参赛）-->
            <el-main v-else-if="sidebarIndex==1 &&role=='学生'" >
                <div v-for ="item in matchData">
                    <match-card v-bind:info="item"></match-card>
                </div>
            </el-main>

            <el-main v-else-if="sidebarIndex==1 &&role=='专家'" >
                <div v-for ="item in matchData">
                    <match-card v-bind:info="item"></match-card>
                </div>
            </el-main>

            <!-- 学生查看已提交申请-->
            <el-main v-else-if="sidebarIndex==2 && role=='学生'">
                <template>
                    <el-table
                            :data="stuApplyData"
                            style="width: 100%">
                        <el-table-column
                                prop="workName"
                                label="作品名称"
                                width="180">
                        </el-table-column>
                        <el-table-column
                                prop="category"
                                label="分类"
                                width="180">
                        </el-table-column>
                        <el-table-column
                                prop="appCategory"
                                label="申请类型"
                                width="180">
                        </el-table-column>
                        <el-table-column
                                prop="state"
                                label="作品状态"
                                wideth="180">
                        </el-table-column>
                        <el-table-column
                            label="操作"
                            wideth="180">
                            <template slot-scope="scope">
                                <el-button type="text" size="mini" @click="downloadPdf(scope.$index)">下载pdf</el-button>
                                <el-button type="text" size="mini">补充提交</el-button>
                            </template>
                    </el-table-column>


                    </el-table>
                </template>

            </el-main>
            <!-- 学生修改个人信息 -->
            <el-main v-else-if="sidebarIndex==3 && role=='学生'">
                <el-row :gutter="12" style="margin-top: 10px">
                    <el-col :offset="6" :span="12">
                        <el-form label-width="80px" class="demo-ruleForm">
                            <el-form-item label="用户名">
                                <el-input v-model="userInfo.username"></el-input>
                            </el-form-item>
                            <el-form-item label="真实姓名">
                                <el-input v-model="userInfo.name"></el-input>
                            </el-form-item>
                            <el-form-item label="个人信息">
                                <el-input type="textarea" v-model="userInfo.introduction"></el-input>
                            </el-form-item>
                            <el-form-item label="电话">
                                <el-input type="number" v-model="userInfo.phone"></el-input>
                            </el-form-item>
                            <el-form-item label="邮箱">
                                <el-input v-model="userInfo.email"></el-input>
                            </el-form-item>
                            <el-form-item label="院系">
                                <el-input v-model="userInfo.department"></el-input>
                            </el-form-item>
                            <el-form-item label="专业">
                                <el-input v-model="userInfo.major"></el-input>
                            </el-form-item>
                            <el-form-item label="入学年份">
                                <el-input type="number" v-model="userInfo.enrollmentYear"></el-input>
                            </el-form-item>
                            <el-form-item>
                                <el-button type="primary" @click="modifyInfo">确认修改</el-button>
                                <el-button @click="resetForm">重置</el-button>
                            </el-form-item>
                        </el-form>
                    </el-col>
                </el-row>
            </el-main>

            <!-- 团委比赛管理 -->
            <el-main v-else-if="sidebarIndex==1 && role=='团委'">
                <el-button type="primary" plain  @click="createMatchDialog"><i class="el-icon-upload"></i>创建比赛</el-button>
                <el-row :gutter="12" style="margin-top: 10px">
                    <el-col :span="24">
                        <el-table :data="matchData" style="width: 100%">
                            <el-table-column fixed width="200" prop="name" label="名称"></el-table-column>
                            <el-table-column width="200" prop="introduction" label="简介"></el-table-column>
                            <el-table-column width="100" prop="joinTime" label="报名时间"></el-table-column>
                            <el-table-column width="100" prop="auditTime" label="初审时间"></el-table-column>
                            <el-table-column width="100" prop="scoreTime" label="评审时间"></el-table-column>
                            <el-table-column width="100" prop="endTime" label="结束时间"></el-table-column>
                            <el-table-column width="100" prop="state" label="状态"></el-table-column>
                            <el-table-column width="75" label="操作" fixed="right" >
                                <template slot-scope="scope">
                                    <el-button style="font-size: 12px" type="primary" size="mini" @click="matchResultDialogShow(scope.$index)">上传结果</el-button>
                                    <el-button style="font-size: 12px" type="danger" size="mini" @click="deleteMatch(scope.$index)">删除</el-button>
                                </template>
                            </el-table-column>
                        </el-table>
                    </el-col>
                </el-row>
                <!-- 创建比赛对话框 --> 
                
                <el-dialog title="创建比赛" :visible.sync="matchDialog">
                    <el-row :gutter="12" style="margin-top: 10px">
                        <el-col :span="24">
                            <el-form label-width="100px">
                                <el-form-item label="比赛名称">
                                    <el-input v-model="createMatch.name"></el-input>
                                </el-form-item>
                                <el-form-item label="简介">
                                    <el-input v-model="createMatch.introduction"></el-input>
                                </el-form-item>
                                <el-form-item label="报名时间">
                                    <el-date-picker type="datetime" v-model="createMatch.joinTime" placeholder="请选择时间" value-format="yyyy-MM-dd HH:mm:SS"></el-date-picker>
                                </el-form-item>
                                <el-form-item label="初审时间">
                                    <el-date-picker type="datetime" v-model="createMatch.auditTime" placeholder="请选择时间" value-format="yyyy-MM-dd HH:mm:SS"></el-date-picker>
                                </el-form-item>
                                <el-form-item label="评审时间">
                                    <el-date-picker type="datetime" v-model="createMatch.scoreTime" placeholder="请选择时间" value-format="yyyy-MM-dd HH:mm:SS"></el-date-picker>
                                </el-form-item>
                                <el-form-item label="结束时间">
                                    <el-date-picker type="datetime" v-model="createMatch.endTime" placeholder="请选择时间" value-format="yyyy-MM-dd HH:mm:SS"></el-date-picker>
                                </el-form-item>
                                <el-form-item label="比赛文件">
                                    <form id = "uploadForm" >
                                        <div class="uploader blue">
                                            <input type="text" class="filename" readonly/>
                                            <input type="button" class="button" value="选择文件"/>
                                            <input type="file" size="30" name="document"/>
                                        </div>
                                    </form>
                                </el-form-item>
                            </el-form>
                        </el-col>
                        <el-col :offset="18" :span="6">
                            <el-button style="font-size: 14px" type="primary" @click="submitCreateMatch">确定</el-button>
                            <el-button style="font-size: 14px" type="info" @click="cancelCreateMatch">取消</el-button>
                        </el-col>
                    </el-row>
                </el-dialog>
                <!-- 上传结果对话框 -->
                <el-dialog title="上传比赛结果" :visible.sync="matchResultDialog">
                    <el-form>
                        <el-form-item label="比赛文件">
                                <form id = "uploadFormResult" >
                                    <div class="uploader blue">
                                        <input type="text" class="filename" readonly/>
                                        <input type="button" class="button" value="选择文件"/>
                                        <input type="file" size="30" name="document"/>
                                    </div>
                                </form>
                            </el-form-item>
                            <el-button type="success" @click="submitMatchResult">上传比赛结果<i class="el-icon-upload"></i></el-button>
                    </el-form>
                </el-dialog>
            </el-main>
            <!-- 团委专家管理 -->
            <el-main v-else-if="sidebarIndex==4 && role=='团委'">
                <el-row :gutter="12" style="margin-top: 0px">
                        <el-col >
                            <el-button style="font-size: 14px" type="primary" plain @click="twAddExpertDialog"><i class="el-icon-plus"></i>新增专家</el-button>
                        </el-col>
                </el-row>
                <el-row :gutter="12" style="margin-top: 10px">
                    <el-col :span="24">
                        <el-table :data="twExpertData" style="width: 100%">
                            <el-table-column fixed width="250" prop="email" label="邮箱"></el-table-column>
                            <el-table-column width="100" prop="name" label="姓名" ></el-table-column>
                            <el-table-column width="200" prop="introduction" label="简介"></el-table-column>
                            <el-table-column width="100" prop="phone" label="电话"></el-table-column>
                            <el-table-column label="操作" fixed="right" width="320">
                                <template slot-scope="scope">
                                    <el-button style="font-size: 12px" type="primary" size="mini" @click="twDeleteExpert(scope.$index)"></el-button>
                                </template>
                            </el-table-column>
                        </el-table>
                    </el-col>
                </el-row>

                <!-- 新增专家对话框 -->
                <el-dialog title="新增专家" :visible.sync="expertDialog">
                    <el-row :gutter="12" style="margin-top: 10px">
                        <el-col :span="24">
                            <el-form label-width="100px">
                                <el-form-item label="姓名">
                                    <el-input v-model="addExpert.name"></el-input>
                                </el-form-item>
                                <el-form-item label="邮箱">
                                    <el-input v-model="addExpert.email"></el-input>
                                </el-form-item>
                                <el-form-item label="初始密码">
                                    <el-input v-model="addExpert.password"></el-input>
                                </el-form-item>
                            </el-form>
                        </el-col>
                        <el-col :offset="18" :span="6">
                            <el-button style="font-size: 14px" type="primary" @click="twSubmitNewExpert">确定</el-button>
                            <el-button style="font-size: 14px" type="info" @click="twCancelNewExpert">取消</el-button>
                        </el-col>
                    </el-row>
                </el-dialog>
            </el-main>

            <!-- 团委申请管理 -->
            <el-main v-else-if="sidebarIndex==3 && role=='团委'">
                <el-row :gutter="12" style="margin-top: 0px">
                        <el-col >
                            <el-button style="font-size: 14px" type="primary" plain @click="resetDateFilter">清除日期过滤器</el-button>
                            <el-button style="font-size: 14px" type="success" plain @click="resetStateFilter">清除状态过滤器</el-button>
                            <el-button style="font-size: 14px" type="warning" plain @click="resetMatchIdFilter">清除比赛名称过滤器</el-button>
                            <el-button style="font-size: 14px" type="danger" plain @click="clearFilter">清除所有过滤器</el-button>
                        </el-col>
                </el-row>
                    <el-row :gutter="12" style="margin-top: 10px">
                        <el-col  :span="24">
                        <el-table
                            ref="filterTable"
                            :data="twApplyData"
                            style="width: 100%">
                            <el-table-column
                            fixed
                            width="150"
                            prop="date"
                            label="日期"
                            sortable
                            column-key="date"
                            :filters="[{text: '2018年秋季学期', value: '2018-09-01'},{text: '2019年春季学期', value: '2019-02-01'},{text: '2019年秋季学期', value: '2019-09-01'},{text: '2020年春季学期', value: '2020-02-01'},{text: '2020年秋季学期', value: '2020-09-01'}]"
                            :filter-method="filterDate">
                            </el-table-column>
                            <el-table-column
                            width="100"
                            prop="name"
                            label="姓名"
                            >
                            </el-table-column>
                
                            <el-table-column
                            width="300"
                            prop="workName"
                            label="作品名称"
                            >
                            </el-table-column>
                
                            <el-table-column
                            width="150"
                            prop="department"
                            label="学院"
                            >
                            </el-table-column>
                
                            <el-table-column
                            width="150"
                            prop="phone"
                            label="联系电话"
                            >
                            </el-table-column>
                
                            <el-table-column
                            width="100"
                            prop="state"
                            label="状态"
                            
                            :filters="[{ text: '已提交', value: '已提交' }, { text: '正在初审', value: '正在初审' },{ text: '初审通过', value: '初审通过' },{ text: '初审未通过', value: '初审未通过' },{ text: '已分配专家', value: '已分配专家' },{ text: '专家评审中', value: '专家评审中' },{ text: '专家已评审', value: '专家已评审' }]"
                            :filter-method="filterState"
                            filter-placement="bottom-end">
                            <template slot-scope="scope">
                                {{scope.row.state}}
                            </template>
                            </el-table-column>
                
                
                            <el-table-column
                            width="100"
                            prop="name"
                            label="比赛名称"
                            
                            :filters="[{ text: '冯如杯', value: '冯如杯' }, { text: '软件', value: '软件' }, { text: '机器人', value: '机器人' }, { text: '人工智能', value: '人工智能' },{ text: '创业', value: '创业' }]"
                            :filter-method="filterMatchName"
                            filter-placement="bottom-end">
                            <template slot-scope="scope">
                                {{scope.row.name}}
                            </template>
                            </el-table-column>
                
                            <el-table-column
                            label="操作"
                            fixed="right"
                            width="320"
                            >
                            <template slot-scope="scope">
                                <el-button style="font-size: 12px" type="primary" size="mini" @click="twPreviewApply(scope.$index)">预览</el-button>
                                <el-button style="font-size: 12px" type="success" size="mini" @click="twPassApply(scope.$index)">通过</el-button>
                                <el-button style="font-size: 12px" type="danger" size="mini" @click="twRefuseApply(scope.$index)">拒绝</el-button>
                                <el-popover
                                    placement="left"
                                    trigger="click">
                                    <el-transfer
                                    style="text-align: left; display: block"
                                    :titles="['可选专家', '已选专家']"
                                    filterable
                                    :filter-method="filterMethod"
                                    filter-placeholder="请输入专家姓名....."
                                    v-model="addedExpertIndex"
                                    :data="twAddExpertForApply">
                                    <el-button type="primary" size="small" class="transfer-footer" slot="right-footer" @click=sendInvite(scope.$index)>发送邮件邀请</el-button>
                                    <el-button type="primary" size="small" class="transfer-footer" slot="left-footer" @click=resetInvite(scope.$index)>重置</el-button>
                                    </el-transfer>
                                    <el-button style="font-size: 12px;margin-left: 10px;" type="info" size="mini" slot="reference" @click="twAddExpert(scope.$index)">分配专家</el-button>
                                </el-popover>
                            </template>
                        </el-table-column>
                        </el-table>
                    </el-col>
                    </el-row>
            </el-main>
        </el-container>
    </el-container>

</div>


</body>
<script type="text/javascript">
    Vue.component('match-card', {
        props: {
            info:Object
        },
        data: function(){
            console.log(this.info);
            return this.info;
        },
        methods: {

            joinMatch(id){
                localStorage.setItem("selMatch",id);
                window.open("apply.html");
            },
            downloadMatchDoc(url){
                const xhr = new XMLHttpRequest();
                xhr.responseType = "arraybuffer";
                xhr.open("GET", "http://58.87.72.138:30000/download?info=" + JSON.stringify({url:url}),true);
                xhr.onload = function(oEvent){
                    console.log("Blobing");
                    let res = xhr.response;
                    console.log(res);
                    var blob = new Blob([res],{type:"application/x-gzip"});
                    console.log(blob);
                    var str = URL.createObjectURL(blob);
                    window.open(str);
                };
                xhr.send();
            },
            downloadMatchResult(url){
                const xhr = new XMLHttpRequest();
                xhr.responseType = "arraybuffer";
                xhr.open("GET", "http://58.87.72.138:30000/download?info=" + JSON.stringify({url:url}),true);
                xhr.onload = function(oEvent){
                    console.log("Blobing");
                    let res = xhr.response;
                    console.log(res);
                    var blob = new Blob([res],{type:"application/x-gzip"});
                    console.log(blob);
                    var str = URL.createObjectURL(blob);
                    window.open(str);
                };
                xhr.send();
            }
        },
        template: '<el-row :gutter="12">\n' +
            '            <el-col :offset="6" :span="12">\n' +
            '                <el-card class="box-card" shadow="hover">\n' +
            '                    <div slot="header" class="clearfix">\n' +
            '                        <span class="matchName">{{ info.name }}</span>\n' +
            '                        <el-button \n' +
            '                        icon="el-icon-position" \n' +
            '                        style="float: right; padding: 3px 0" \n' +
            '                        type="text" @click="joinMatch(info.id)">参加比赛</el-button>\n' +
            '                    </div>\n' +
            '                    <div class="text item">{{ "比赛简介： "+ info.introduction }}</div>\n' +
            '                    <div class="text item">{{ "报名开始时间： "+ info.joinTime }}</div>\n' +
            '                    <div class="text item">{{ "报名截止、初审开始时间： "+ info.auditTime }}</div>\n' +
            '                    <div class="text item">{{ "初审结束、评审开始时间： "+ info.scoreTime }}</div>\n' +
            '                    <div class="text item">{{ "评审结束时间： "+ info.endTime }}</div>\n' +
            '                    <el-button type="primary" plain @click="downloadMatchDoc(info.coverUrl)">下载附件</el-button>\n'+
            '                    <el-button type="success" plain @click="downloadMatchResult(info.resultUrl)">查看结果</el-button>\n'+
            '                </el-card>\n' +
            '            </el-col>\n' +
            '        </el-row>',
    });

    new Vue({
        el: '#main',
        data: function() {  
            const generateData = _ => {
              const data = [];
              const experts = ['王教授', '北教授'];
              experts.forEach((expert, index) => {
                data.push({
                  label: expert,
                  key: index,
                });
              });
              return data;
            };
            return {
                sidebarIndex : 1,
                matchData: null,
                userInfo: null,
                role: null,
                stuApplyData:null,
                twApplyData:null,
                previewUrl:null,
                twAddExpertForApply:generateData(),
                addedExpertIndex:[],
                expertTemp:[],
                twExpertData: null,
                filterMethod(query, item) {
                    return item.label == query || query == '';
                },
                matchDialog: false,
                expertDialog:false,
                addExpert:{},
                matchResultDialog: false,
                createMatch: {},
                matchResultIndex: 0,

                id: 0,
                auditVisible: false,
                editComment:false,
                viewComment:false,
                auditData:[
                ],
                editAuditForm: {
                    comment: '',
                },
                info:{"expertId":"2","state":null},
            }
        },
        created(){
            var _self=this;
            this.getUserInfo();
            switch(sessionStorage.getItem("role")){
                case '学生':
                    this.getStuApply();
                    this.getMatchData();
                    break;
                case '团委':
                    this.getTwApply();
                    this.getMatchData();
                    this.getTwExpert();
                    break;
                case '专家':
                    this.getMatchData();
                    this.getApplicationByAssessmentState();
                    break;
            }
        },
        methods: {
            //专家预览
            previewImg(index){
                var url = this.auditData[index].imgUrl;
                localStorage.setItem("imgUrl",url);
                window.open("preview.html");
            },
            previewVid(index){
                var url = this.auditData[index].vidUrl;
                localStorage.setItem("vidUrl",url);
                window.open("previewVid.html");
            },
            previewDoc(index){
                var url = this.auditData[index].docUrl;
                window.open('http://ow365.cn/?i=19000&furl=http://58.87.72.138:30000/getFile?info={"url":"'+url+'"}');
            },
            deleteMatch(index) {
                var _self = this;
                if (this.matchData[index].state == 'created') {
                    $.ajax({  
                        url: 'http://58.87.72.138:30000/deleteMatchById' ,  
                        type: 'get',
                        dataType: 'json',
                        contentType:"application/json",
                        data: { info: JSON.stringify({ id: _self.matchData[index].id }) },
                        success: res => {
                            var data = res;
                            console.log(data);
                            if(data.err == false) {
                                _self.$notify({
                                    message: '删除比赛成功',
                                    type: 'success',
                                    title:'成功'
                                });
                                setTimeout(() => { window.location.href = "main.html"; }, 1000);
                            } else{
                                _self.$notify({
                                    message: '删除比赛失败',
                                    type: 'error',
                                    title:'失败',
                                });
                            }
                        },  
                        error: err => console.log(err)
                    });
                } else {
                    _self.$notify({
                        message: '比赛已经开始，无法删除',
                        type: 'error',
                        title:'失败'
                    });
                }
            },
            //团委重置已选中专家
            resetInvite(index){
                this.addedExpertIndex = [];
                this.$notify({
                    message: '重置成功',
                    type: 'success',
                    title:'成功'
                });
            },
            update: function(){
                $("input[type=file]").change(function(){
                    $(this).parents(".uploader").find(".filename").val($(this).val());
                });
                $("input[type=file]").each(function(){
                    if($(this).val()=="") {
                        $(this).parents(".uploader").find(".filename").val("请选择文件");
                    }
                });
            },
            updateResult: function(){
                $("input[type=file]").change(function(){
                    $(this).parents(".uploader").find(".filename").val($(this).val());
                });
                $("input[type=file]").each(function(){
                    if($(this).val()=="") {
                        $(this).parents(".uploader").find(".filename").val("请选择文件");
                    }
                });
            },
            createMatchDialog() {
                this.matchDialog = true;
                this.$nextTick(() => this.update());
            },
            cancelCreateMatch() {
                this.matchDialog = false;
            },
            //团委新增专家 对话框
            twAddExpertDialog() {
                this.expertDialog = true;
            },
            twCancelNewExpert() {
                this.expertDialog = false;
            },
            twSubmitNewExpert() {
                var _self = this;
                $.ajax({
                    url: "http://58.87.72.138:30000/expertRegister",
                    type: "get",
                    dataType: 'json',
                    contentType:"application/json",
                    data: {
                        info: JSON.stringify({
                            name: _self.addExpert.name,
                            email: _self.addExpert.email,
                            password: _self.addExpert.password,
                        }),
                    },
                    success: function(res){
                        console.log(res);
                        if(res.err == false){
                            _self.$notify({
                                message: '新增专家成功',
                                type: 'success',
                                title:'成功'
                            });
                            _self.getTwExpert();
                            _self.expertDialog = false;
                        }
                        else{
                            _self.$notify({
                                message: '新增专家失败',
                                type: 'error',
                                title:'失败'
                            });
                        }
                    },
                    error: function(err){
                        console.log(err);
                    }
                });
            },
            matchResultDialogShow(index) {
                this.matchResultIndex = index;
                this.matchResultDialog = true;
                this.$nextTick(() => this.updateResult());
            },
            submitCreateMatch() {
                var _self = this;
			    var formData = new FormData($( "#uploadForm" )[0]);  
                $.ajax({  
                    url: 'http://58.87.72.138:30000/upload',
                    type: 'POST',  
                    data: formData,  
                    async: false,  
                    cache: false,  
                    contentType: false,  
                    processData: false,  
                    success: function (res) {
                        var data = JSON.parse(res);
                        console.log(data);
                        if(data.err == false){
                            _self.createMatch.coverUrl = data.documentUrl[0];
                            $.ajax({
                                url: "http://58.87.72.138:30000/createMatch",
                                type: "get",
                                dataType: 'json',
                                contentType:"application/json",
                                data: {
                                    info: JSON.stringify({
                                        name: _self.createMatch.name,
                                        introduction: _self.createMatch.introduction,
                                        coverUrl: _self.createMatch.coverUrl,
                                        joinTime: _self.createMatch.joinTime,
                                        auditTime: _self.createMatch.auditTime,
                                        scoreTime: _self.createMatch.scoreTime,
                                        endTime: _self.createMatch.endTime,
                                    }),
                                },
                                success: function(res){
                                    console.log(res);
                                    if(res.err == false){
                                        _self.$notify({
                                            message: '创建比赛成功',
                                            type: 'success',
                                            title:'成功'
                                        });
                                        setTimeout(() => {
                                            window.location.href="main.html";
                                        }, 1000);
                                    }
                                    else{
                                        _self.$notify({
                                            message: '创建比赛失败',
                                            type: 'error',
                                            title:'失败'
                                        });
                                    }
                                },
                                error: function(err){
                                    console.log(err);
                                }
                            });
                        }
                        else{
                            _self.$message({
                                message: '比赛文件上传失败',
                                type: 'error',
                                title:'失败'
                            });
                        }
                    },  
                    error: function (err) {  
                        console.log(err);  
                    }  
                });
            },
            submitMatchResult() {
                var _self = this;
                var index = this.matchResultIndex;
                var formData = new FormData($( "#uploadFormResult" )[0]);  
                $.ajax({  
                    url: 'http://58.87.72.138:30000/uploadMatchResult' ,  
                    type: 'POST',  
                    data: formData,  
                    async: false,  
                    cache: false,  
                    contentType: false,  
                    processData: false,  
                    success: function (res) {
                        var data = JSON.parse(res);
                        console.log(data);
                        if(data.err == false){
                            $.ajax({
                                url: "http://58.87.72.138:30000/setMatchResultUrlById",
                                type: "get",
                                dataType: 'json',
                                contentType:"application/json",
                                data: {
                                    info: JSON.stringify({
                                        url: data.url[0],
                                        id: _self.matchData[index].id
                                    }),
                                },
                                success: function(res){
                                    console.log(res);
                                    if(res.err == false){
                                        _self.$notify({
                                            message: '上传比赛结果成功',
                                            type: 'success',
                                            title:'成功'
                                        });
                                        setTimeout(() => {
                                            window.location.href="main.html";
                                        }, 1000);
                                    }
                                    else{
                                        _self.$notify({
                                            message: '上传比赛结果失败',
                                            type: 'error',
                                            title:'失败'
                                        });
                                    }
                                },
                                error: function(err){
                                    console.log(err);
                                }
                            });
                        }
                        else{
                            _self.$message({
                                message: '比赛文件上传失败',
                                type: 'error',
                                title:'失败'
                            });
                        }
                    },  
                    error: function (err) {  
                        console.log(err);  
                    }  
                });
            },
            //专家评分方法
            handleEdit(index, row){
                this.editComment=true;
                this.editAuditForm = Object.assign({},row.comment);
            },
            getApplicationByAssessmentState(){
                var _self = this;
                $.ajax({
                    url: "http://58.87.72.138:30000/expertGetApplicationByAssessmentState",
                    type: "get",
                    dataType: 'json',
                    contentType:"application/json",
                    data:{
                        info: JSON.stringify(_self.info),
                    },
                    success: function(res){
                        console.log(res);
                        data = res.data;
                        var count = 1;
                        for(item in data){
                            var ap = {
                                id: count,
                                workName: data[item].workName,
                                name: data[item].name,
                                imgUrl:data[item].imageUrl,
                                vidUrl:data[item].videoUrl,
                                docUrl:data[item].documentUrl,
                            }
                            console.log(ap);
                            _self.auditData.push(ap);
                            count += 1;
                        }
                        console.log(_self.data);
                    },
                    error: function(err){
                        console.log(err);
                    }
                })
            },

            //团委给被选中的专家发送邀请
            sendInvite(index) {
                var _self = this;
                var applicationId = this.twApplyData[index].id;
                for(var i in this.addedExpertIndex){
                    var expertId = this.expertTemp[this.addedExpertIndex[i]].id;
                    var email = this.expertTemp[this.addedExpertIndex[i]].email;
                    console.log("expert email: " + email);
                    $.ajax({
                        url: "http://58.87.72.138:30000/inviteExpert",
                        type: "get",
                        dataType: 'json',
                        contentType:"application/json",
                        data: {
                            info: JSON.stringify({
                                applicationId: applicationId,
                                expertId: expertId,
                                email: email
                            }),
                        },
                        success: function(res){
                            console.log(res);
                            if(res.err == false){
                                _self.$notify({
                                    message: '邀请成功',
                                    type: 'success',
                                    title:'成功'
                                });
                            }
                            else{
                                _self.$notify({
                                    message: '邮件发送失败',
                                    type: 'error',
                                    title:'失败'
                                });
                            }

                        },
                        error: function(err){
                            console.log(err);
                        }
                    });

                }       
            },            
            //团委查找专家信息，以分配专家
            twAddExpert(index) {
                var _self=this;
                _self.twAddExpertForApply = [];
                _self.addedExpertIndex = [];
                var applicationId = this.twApplyData[index].id;
                $.ajax({
                    url: "http://58.87.72.138:30000/getExpertByApplication",
                    type: "get",
                    dataType: 'json',
                    contentType:"application/json",
                    data: {
                        info: JSON.stringify({ applicationId: applicationId,invited:"false" }),
                    },
                    success: function(res){
                        console.log(res);
                        if(res.err == false){
                            var expertNames = [];
                            _self.expertTemp = res.data;
                            for(var i in res.data){
                                expertNames.push(res.data[i].name);
                            }
                            expertNames.forEach((expert, index) => {
                                _self.twAddExpertForApply.push({
                                    label: expert,
                                    key: index,
                                });
                            });
                        }
                        else{
                            _self.$notify({
                                message: '获取专家失败',
                                type: 'error',
                                title:'失败'
                            });
                        }

                    },
                    error: function(err){
                        console.log(err);
                    }
                });
            },
            //创建比赛
            deleteRow(index, rows) {
                rows.splice(index, 1);
            },
            /*edit(index,row){
              this.createCompetition=true;
              alert(row[index].endDate);
            },*/
            submitForm(formName) {
                let self=this;
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        var a={nameM:self.createCompetitionForm.name, matchTypeM:self.createCompetitionForm.matchType, startDateM:self.createCompetitionForm.startDate, endDateM:self.createCompetitionForm.endDate, introductionM:self.createRules.introduction, remove: false};
                        self.createData.push(a);
                        this.createCompetition=false;
                        this.$refs[formName].resetFields();
                        self.$notify({
                            message:'比赛创建成功！',
                            type:'success',
                            title:'成功'
                        });
                    } else {
                        alert('创建失败，请检查是否有漏填信息！');
                        console.log('error submit!!');
                        return false;
                    }
                });
            },
            resetForm(formName) {
                this.$refs[formName].resetFields();
            },
            handleRemove(file, fileList) {
                console.log(file, fileList);
            },
            handlePreview(file) {
                console.log(file);
            },
            submitUpload() {
                this.$refs.upload.submit();
            },
            beforeUpload(file) {
                var testmsg=file.name.substring(file.name.lastIndexOf('.')+1)
                const extension = testmsg === 'xls'
                const extension2 = testmsg === 'xlsx'
                const extension3 = testmsg === 'pdf'
                const isLt2M = file.size / 1024 / 1024 < 10     //这里做文件大小限制
                if(!extension && !extension2 && !extension3) {
                    this.$notify({
                        message: '上传文件只能是 xls、xlsx、pdf格式!',
                        type: 'warning',
                        title:'警告'
                    });
                }
                if(!isLt2M) {
                    this.$notify({
                        message: '上传文件大小不能超过 10MB!',
                        type: 'warning',
                        title:'警告'
                    });
                }
                return extension || extension2 && isLt2M
            },
            //其他方法
            downloadData(url){
                const xhr = new XMLHttpRequest();
                xhr.responseType = "arraybuffer";
                xhr.open("GET", "http://58.87.72.138:30000/download?info=" + JSON.stringify({url:url}),true);
                xhr.onload = function(oEvent){
                    console.log("Blobing");
                    let res = xhr.response;
                    console.log(res);
                    var blob = new Blob([res],{type:"application/x-gzip"});
                    console.log(blob);
                    var str = URL.createObjectURL(blob);
                    window.location.href=str;
                };
                xhr.send();
            },
            downloadPdf(index){
                var url = this.stuApplyData[index].pdfUrl;
                this.downloadData(url);
            },
            twSetSidebarIndex(index) {
                this.sidebarIndex = index;
                switch (index) {
                    case 3:
                        this.getTwApply();
                        break;
                    case 4:
                        this.getTwExpert();
                        break;
                }
            },
            expertSetSidebarIndex(index) {
                this.sidebarIndex = index;
                if(index == 1){
                    this.getMatchData();
                }
            },
            twPassApply(index){
                var state = this.twApplyData[index].state;
                var _self=this;
                if(state == "正在初审" || state == "初审通过" || state == "初审未通过"){
                    $.ajax({
                    url: "http://58.87.72.138:30000/setApplicationState",
                    type: "get",
                    dataType: 'json',
                    contentType:"application/json",
                    data: {
                        info: JSON.stringify({ state: "accepted", applicationId: this.twApplyData[index].id }),
                    },
                    success: function(res){
                        console.log(res);
                        if(res.err == false){
                            _self.twApplyData[index].state = "初审通过";
                            _self.$notify({
                                message: '修改申请状态成功',
                                type: 'success',
                                title:'成功'
                            });
                        }
                        else{
                            _self.$notify({
                                message: '修改申请状态失败',
                                type: 'error',
                                title:'失败'
                            });
                        }

                    },
                    error: function(err){
                        console.log(err);
                    }

                })
                }
                else {
                    _self.$notify({
                        message: '申请状态异常，无法进行通过初审操作',
                        type: 'error',
                        title:'失败'
                    });
                }
            },
            twRefuseApply(index){
                var state = this.twApplyData[index].state;
                var _self=this;
                if(state == "正在初审" || state == "初审通过" || state == "初审未通过"){
                    $.ajax({
                    url: "http://58.87.72.138:30000/setApplicationState",
                    type: "get",
                    dataType: 'json',
                    contentType:"application/json",
                    data: {
                        info: JSON.stringify({ state: "refused", applicationId: this.twApplyData[index].id }),
                    },
                    success: function(res){
                        console.log(res);
                        if(res.err == false){
                            _self.twApplyData[index].state = "初审未通过";
                            _self.$notify({
                                message: '修改申请状态成功',
                                type: 'success',
                                title:'成功'
                            });
                        }
                        else{
                            _self.$notify({
                                message: '修改申请状态失败',
                                type: 'error',
                                title:'失败'
                            });
                        }

                    },
                    error: function(err){
                        console.log(err);
                    }

                })
                }
                else {
                    _self.$notify({
                        message: '申请状态异常，无法进行通过初审操作',
                        type: 'error',
                        title:'失败'
                    });
                }
            },
            twPreviewApply(index){
                this.previewUrl = this.twApplyData[index].pdfUrl;
                window.open('http://ow365.cn/?i=19000&furl=http://58.87.72.138:30000/getFile?info={"url":"'+this.previewUrl+'"}');
            },
            getTwExpert(){
                var _self = this;
                $.ajax({
                    url: "http://58.87.72.138:30000/getExpert",
                    type: "get",
                    dataType: 'json',
                    contentType:"application/json",
                    data: {},
                    success: res => {
                        console.log(res);
                        if(res.err == false) {
                            _self.twExpertData = res.data;
                            // _self.$message({
                            //     message: '获取专家成功',
                            //     type: 'success',
                            //     center: true
                            // });
                        }
                        else{
                            _self.$notify({
                                message: '获取专家失败',
                                type: 'error',
                                title:'成功'
                            });
                        }
                    },
                    error: err => console.log(err)
                })
            },
            getTwApply(){
                var _self=this;
                $.ajax({
                    url: "http://58.87.72.138:30000/getApplicationByState",
                    type: "get",
                    dataType: 'json',
                    contentType:"application/json",
                    data: {
                        info: JSON.stringify({state:null}),
                    },
                    success: function(res){
                        console.log(res);
                        if(res.err == false){
                            _self.twApplyData=res.data;
                            for(var i in _self.twApplyData){
                                switch (_self.twApplyData[i].state) {
                                    case 'submitted':
                                        _self.twApplyData[i].state='已提交';
                                        break;
                                    case 'auditing':
                                        _self.twApplyData[i].state='正在初审';
                                        break;
                                    case 'accepted':
                                        _self.twApplyData[i].state='初审通过';
                                        break;
                                    case 'refused':
                                        _self.twApplyData[i].state='初审未通过';
                                        break;
                                    case 'assigned':
                                        _self.twApplyData[i].state='已分配专家';
                                        break;
                                    case 'scoring':
                                        _self.twApplyData[i].state='专家评审中';
                                        break;
                                    case 'scored':
                                        _self.twApplyData[i].state='专家已评审';
                                        break;
                                }
                            }
                            // _self.$notify({
                            //     message: '获取申请成功',
                            //     type: 'success',
                            //     title:'成功'
                            // });
                        }
                        else{
                            _self.$notify({
                                message: '获取申请失败',
                                type: 'error',
                                title:'失败'
                            });
                        }
                    },
                    error: function(err){
                        console.log(err);
                    }

                })
            },
            getStuApply(){
                var _self=this;
                var info = {
                    studentNumber: sessionStorage.getItem("studentNumber"),
                };
                console.log(sessionStorage.getItem("studentNumber"));
                $.ajax({
                    url: "http://58.87.72.138:30000/studentGetApplication",
                    type: "get",
                    dataType: 'json',
                    contentType:"application/json",
                    data: {
                        info: JSON.stringify(info),
                    },
                    success: function(res){
                        console.log(res);
                        if(res.err == false){
                            _self.stuApplyData=res.data;
                            for(var i in _self.stuApplyData){
                                switch (_self.stuApplyData[i].state) {
                                    case 'submitted':
                                        _self.stuApplyData[i].state='已提交';
                                        break;
                                    case 'auditing':
                                        _self.stuApplyData[i].state='正在初审';
                                        break;
                                    case 'accepted':
                                        _self.stuApplyData[i].state='初审通过';
                                        break;
                                    case 'refused':
                                        _self.stuApplyData[i].state='初审未通过';
                                        break;
                                    case 'assigned':
                                        _self.stuApplyData[i].state='已分配专家';
                                        break;
                                    case 'scoring':
                                        _self.stuApplyData[i].state='专家评审中';
                                        break;
                                    case 'scored':
                                        _self.stuApplyData[i].state='专家已评审';
                                        break;
                                }
                            }
                            // _self.$notify({
                            //     message: '获取申请成功',
                            //     type: 'success',
                            //     title:'成功'
                            // });
                        }
                        else{
                            _self.$notify({
                                message: '获取申请失败',
                                type: 'error',
                                title:'失败'
                            });
                        }

                    },
                    error: function(err){
                        console.log(err);
                    }

                })
            },
            getMatchData(){
                var _self=this;
                $.ajax({
                    url: "http://58.87.72.138:30000/getMatch",
                    type: "get",
                    dataType: 'json',
                    contentType:"application/json",
                    success: function(res){
                        console.log(res);
                        if(res.err == false){
                            _self.matchData=res.data;
                            console.log(res.data);
                            console.log(_self.matchData);
                            // _self.$notify({
                            //     message: '获取比赛成功',
                            //     type: 'success',
                            //     title:'成功'
                            // });
                        }
                        else{
                            _self.$notify({
                                message: '获取比赛失败',
                                type: 'error',
                                title:'失败'
                            });
                        }

                    },
                    error: function(err){
                        console.log(err);
                    }

                })

            },
            stuSetSidebarIndex(index) {
                this.sidebarIndex = index;
            },
            getUserInfo() {
                this.role = sessionStorage.getItem("role");
                switch (this.role) {
                    case "学生":
                        this.userInfo = {
                            studentNumber: sessionStorage.getItem('studentNumber'),
                            username: sessionStorage.getItem("username"),
                            name: sessionStorage.getItem('name'),
                            introduction: sessionStorage.getItem('introduction'),
                            profileUrl: sessionStorage.getItem('profileUrl'),
                            phone: sessionStorage.getItem('phone'),
                            email: sessionStorage.getItem('email'),
                            department: sessionStorage.getItem('department'),
                            major: sessionStorage.getItem('major'),
                            enrollmentYear: sessionStorage.getItem('enrollmentYear')
                        };
                        break;
                    case "专家":
                        this.userInfo = {
                            username: sessionStorage.getItem("username"),
                            name: sessionStorage.getItem('name'),
                            introduction: sessionStorage.getItem('introduction'),
                            profileUrl: sessionStorage.getItem('profileUrl'),
                            phone: sessionStorage.getItem('phone'),
                            email: sessionStorage.getItem('email'),
                            category: sessionStorage.getItem('category')
                        };
                        break;
                    case "团委":
                        this.userInfo = {
                            username: sessionStorage.getItem("username"),
                        };
                        break;
                }
            },
            modifyInfo() {
                var _self = this;
                switch (this.role) {
                    case "学生":
                        $.ajax({
                            url: "http://58.87.72.138:30000/studentModifyInfo",
                            type: "get",
                            dataType: 'json',
                            contentType:"application/json",
                            data: { info: JSON.stringify(this.userInfo), },
                            success: function(res){
                                console.log(res);
                                if(res.err == false){
                                    sessionStorage.setItem('username',_self.userInfo.username);
                                    sessionStorage.setItem('name',_self.userInfo.name);
                                    sessionStorage.setItem('introduction',_self.userInfo.introduction);
                                    sessionStorage.setItem('profileUrl',_self.userInfo.profileUrl);
                                    sessionStorage.setItem('phone',_self.userInfo.phone);
                                    sessionStorage.setItem('email',_self.userInfo.email);
                                    sessionStorage.setItem('department',_self.userInfo.department);
                                    sessionStorage.setItem('major',_self.userInfo.major);
                                    sessionStorage.setItem('enrollmentYear',_self.userInfo.enrollmentYear);

                                    _self.$notify({
                                        message: '修改成功',
                                        type: 'success',
                                        title:'成功'
                                    });
                                    setTimeout(() => { window.location.href="main.html"; }, 1000);
                                }
                                else{
                                    _self.$notify({
                                        message: '修改失败',
                                        type: 'error',
                                        title:'失败'
                                    });
                                }
                            },
                            error: err => { console.log(err); }
                        })
                    break;
                    case "专家":
                        $.ajax({
                            url: "http://58.87.72.138:30000/expertModifyInfo",
                            type: "get",
                            dataType: 'json',
                            contentType:"application/json",
                            data: { info: JSON.stringify(this.userInfo), },
                            success: function(res){
                                console.log(res);
                                if(res.err == false){
                                    sessionStorage.setItem('username',_self.userInfo.username);
                                    sessionStorage.setItem('name',_self.userInfo.name);
                                    sessionStorage.setItem('introduction',_self.userInfo.introduction);
                                    sessionStorage.setItem('profileUrl',_self.userInfo.profileUrl);
                                    sessionStorage.setItem('phone',_self.userInfo.phone);
                                    sessionStorage.setItem('email',_self.userInfo.email);
                                    sessionStorage.setItem('category',_self.userInfo.category);

                                    _self.$notify({
                                        message: '修改成功',
                                        type: 'success',
                                        title:'成功'
                                    });
                                    setTimeout(() => { window.location.href="main.html"; }, 1000);
                                }
                                else{
                                    _self.$notify({
                                        message: '修改失败',
                                        type: 'error',
                                        title:'失败'
                                    });
                                }
                            },
                            error: err => { console.log(err); }
                        })
                    break;
                }
            },
            resetDateFilter() {
                this.$refs.filterTable.clearFilter('date');
            },
            resetStateFilter() {
                this.$refs.filterTable.clearFilter('state');
            },
            resetMatchIdFilter() {
                this.$refs.filterTable.clearFilter('matchId');
            }, 
            clearFilter() {
                this.$refs.filterTable.clearFilter();
            },
            formatter(row, column) {
                return row.address;
            },
            //日期，比赛ID，申请状态筛选 [{text: '2018年秋季学期', value: '2018-09-01'},
            // {text: '2019年春季学期', value: '2019-02-01'},
            // {text: '2019年秋季学期', value: '2019-09-01'},
            // {text: '2020年春季学期', value: '2020-02-01'},
            // {text: '2020年秋季学期', value: '2020-09-01'}]
            filterDate(value, row, column) {
                const property = column['property'];
                switch(value){
                    case '2018-09-01':
                        return row[property] > '2018-09-01' && row[property] < '2019-02-01';
                    case '2019-02-01':
                        return row[property] > '2019-02-01' && row[property] < '2019-09-01';
                    case '2019-09-01':
                        return row[property] > '2019-09-01' && row[property] < '2020-02-01';
                    case '2020-02-01':
                        return row[property] > '2020-02-01' && row[property] < '2020-09-01';
                    case '2020-09-01':
                        return row[property] > '2020-09-01' && row[property] < '2020-12-30';
                    default:
                        return true;
                }
            },
            filterMatchName(value, row, column) {
                const property = column['property'];
                switch(value){
                    case '冯如杯':
                        return row[property].indexOf('冯如杯') >= 0;
                    case '人工智能':
                        return row[property].indexOf('人工智能') >= 0;
                    case '机器人':
                        return row[property].indexOf('机器人') >= 0;
                    case '创业':
                        return row[property].indexOf('创业') >= 0;
                    case '软件':
                        return row[property].indexOf('软件') >= 0;
                    default:
                        return true;
                }
            },
            filterState(value, row, column) {
                return row.state === value;
            }
        }
    })
</script>
</html>